#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Pydantic models for fundamental 10-K analysis.

BACKWARD COMPATIBILITY LAYER
This file now imports from models/ subdirectory.
Existing code will continue to work without changes.

Extracted from standardized_sec_ai/tenk_models.py
"""

# Import everything from models for backward compatibility
from .models.basic import (
    FinancialHighlights,
    TenKAnalysis,
    RevenueSegment,
    GeographicBreakdown,
    CustomDeepDiveAnalysis,
    BusinessModelSustainability,
    CompetitivePositioning,
    FinancialHealth,
    RiskAssessment,
    FocusedAnalysis,
    EVManufacturerMetrics,
)

from .models.success_factors import (
    StrategicShift,
    BusinessModel,
    PerformanceFactor,
    FinancialMetrics,
    MarketPosition,
    ManagementAssessment,
    ResearchDevelopment,
    RiskMethodology,
    EvolvingRiskFactor,
    StakeholderImpacts,
    ForwardOutlook,
    CompanySuccessFactors,
)

# Export all models (maintains backward compatibility)
__all__ = [
    # Basic models
    'TenKAnalysis',
    'FinancialHighlights',
    'CustomDeepDiveAnalysis',
    'FocusedAnalysis',
    'EVManufacturerMetrics',
    'RevenueSegment',
    'GeographicBreakdown',
    'BusinessModelSustainability',
    'CompetitivePositioning',
    'FinancialHealth',
    'RiskAssessment',
    # Multi-year success factors schemas
    'CompanySuccessFactors',
    'BusinessModel',
    'PerformanceFactor',
    'FinancialMetrics',
    'MarketPosition',
    'ManagementAssessment',
    'ResearchDevelopment',
    'RiskMethodology',
    'EvolvingRiskFactor',
    'StakeholderImpacts',
    'ForwardOutlook',
    'StrategicShift',
]


# DEPRECATED: The following class definitions are kept for reference but should not be used
# All new code should import from .models.basic and .models.success_factors
# This section will be removed in a future version

from typing import List, Optional, Dict, Any
from pydantic import BaseModel, Field


class _DeprecatedFinancialHighlights(BaseModel):
    """Financial highlights from the 10-K"""
    revenue: str = Field(description="Total revenue with growth/decline rate")
    profit: str = Field(description="Net income/loss and margin details")
    cash_position: str = Field(description="Cash and debt information, objectively assessed")


class TenKAnalysis(BaseModel):
    """
    Default structured output for 10-K analysis.
    Use this model for consistent, validated AI responses.
    """
    business_model: str = Field(
        description="Objective explanation of the company's business model and how it generates revenue"
    )
    unique_value: str = Field(
        description="Objective assessment of what differentiates this company, whether positively or negatively"
    )
    key_strategies: List[str] = Field(
        description="List of key strategic initiatives or focus areas"
    )
    financial_highlights: FinancialHighlights = Field(
        description="Key financial metrics and trends"
    )
    risks: List[str] = Field(
        description="Major risks and challenges the company faces"
    )
    management_quality: str = Field(
        description="Balanced assessment of leadership and governance strengths and weaknesses"
    )
    innovation: str = Field(
        description="Objective analysis of the company's R&D and innovation approach, whether effective or not"
    )
    competitive_position: str = Field(
        description="Realistic assessment of market position and competitive landscape"
    )
    esg_factors: str = Field(
        description="Environmental, social and governance considerations, both positive and negative"
    )
    key_takeaways: List[str] = Field(
        description="3-5 balanced insights highlighting both strengths and weaknesses"
    )


class RevenueSegment(BaseModel):
    """Revenue breakdown by segment"""
    segment_name: str
    revenue: str
    percentage_of_total: str
    growth_rate: str


class GeographicBreakdown(BaseModel):
    """Geographic revenue distribution"""
    region: str
    revenue: str
    percentage_of_total: str


class CustomDeepDiveAnalysis(BaseModel):
    """
    Custom deep-dive analysis model.
    Provides detailed revenue and operational breakdowns.
    """
    revenue_segments: List[RevenueSegment] = Field(
        description="Revenue composition by business segment"
    )
    geographic_breakdown: List[GeographicBreakdown] = Field(
        description="Geographic distribution of sales"
    )
    capex_trends: str = Field(
        description="Capital expenditure trends and analysis"
    )
    rd_intensity: str = Field(
        description="R&D spending as percentage of revenue and trends"
    )
    competitive_moats: List[str] = Field(
        description="Key competitive advantages and their sustainability"
    )


class BusinessModelSustainability(BaseModel):
    """Business model assessment"""
    is_defensible: bool
    unit_economics: str
    revenue_model: str


class CompetitivePositioning(BaseModel):
    """Competitive analysis"""
    main_competitors: List[str]
    competitive_advantage: str
    moat_sustainability: str


class FinancialHealth(BaseModel):
    """Financial health metrics"""
    cash_burn_rate: str
    path_to_profitability: str
    capital_allocation_strategy: str


class RiskAssessment(BaseModel):
    """Risk analysis"""
    top_risks: List[str] = Field(description="Top 3 existential risks")
    mitigation_strategies: List[str]


class FocusedAnalysis(BaseModel):
    """
    Focused deep dive analysis.
    Emphasizes business model sustainability and competitive positioning.
    """
    business_model_sustainability: BusinessModelSustainability
    competitive_positioning: CompetitivePositioning
    financial_health: FinancialHealth
    risk_assessment: RiskAssessment


class EVManufacturerMetrics(BaseModel):
    """
    Industry-specific analysis for EV manufacturers.
    """
    vehicle_production_capacity: str = Field(
        description="Current and projected production capacity"
    )
    battery_technology: str = Field(
        description="Battery technology, costs, and supply chain"
    )
    charging_infrastructure: str = Field(
        description="Charging network and infrastructure strategy"
    )
    rd_spending: str = Field(
        description="R&D spending and focus areas"
    )
    government_incentives: str = Field(
        description="Dependencies on government incentives and policies"
    )
    key_metrics: Dict[str, str] = Field(
        description="Key operational and financial metrics"
    )


# Multi-Year Success Factor Analysis Schemas

class StrategicChange(BaseModel):
    """A significant strategic change over time"""
    year: str = Field(description="Year when the change occurred")
    change: str = Field(description="Description of the strategic change")
    impact: str = Field(description="How this affected the company")


class BusinessEvolution(BaseModel):
    """Evolution of business model over time"""
    core_model: str = Field(description="The fundamental business model")
    key_changes: List[StrategicChange] = Field(
        description="Major strategic changes over the years"
    )
    strategic_consistency: str = Field(
        description="Areas where strategy remained consistent"
    )


class SuccessFactor(BaseModel):
    """A key factor contributing to company success"""
    factor: str = Field(description="The success factor")
    importance: str = Field(description="Why this factor was crucial")
    evolution: str = Field(description="How this factor evolved over time")


class FinancialPerformance(BaseModel):
    """Multi-year financial performance analysis"""
    revenue_trends: str = Field(description="Revenue growth patterns")
    profitability: str = Field(description="Profit margin trends")
    capital_allocation: str = Field(description="How capital was allocated")
    financial_strengths: List[str] = Field(
        description="Financial competitive advantages"
    )


class CompetitiveAdvantage(BaseModel):
    """A specific competitive advantage"""
    advantage: str = Field(description="The competitive advantage")
    sustainability: str = Field(description="How sustainable it is")
    impact: str = Field(description="How it created value")


class ManagementExcellence(BaseModel):
    """Management quality assessment"""
    key_decisions: List[str] = Field(description="Important management decisions")
    leadership_qualities: List[str] = Field(
        description="Leadership attributes that drove success"
    )
    governance: str = Field(description="Corporate governance assessment")


class InnovationStrategy(BaseModel):
    """Innovation approach over time"""
    approach: str = Field(description="Overall innovation approach")
    key_innovations: List[str] = Field(
        description="Significant innovations or R&D investments"
    )
    results: str = Field(description="Outcomes of innovation efforts")


class RiskManagement(BaseModel):
    """Risk management approach"""
    approach: str = Field(description="Overall approach to risk")
    key_risks_addressed: List[str] = Field(
        description="Major risks successfully managed"
    )
    vulnerabilities: List[str] = Field(description="Remaining vulnerabilities")


class ValueCreation(BaseModel):
    """How value was created for stakeholders"""
    customer_value: str = Field(description="Value created for customers")
    shareholder_value: str = Field(description="Value created for shareholders")
    societal_value: str = Field(description="Broader impact and ESG contributions")


class FutureOutlook(BaseModel):
    """Forward-looking assessment"""
    strengths_to_leverage: List[str] = Field(description="Key strengths for growth")
    challenges_to_address: List[str] = Field(description="Challenges needing attention")
    growth_potential: str = Field(description="Future growth potential assessment")


class CompanySuccessFactors(BaseModel):
    """
    Multi-year success factor analysis.
    Synthesizes patterns across multiple 10-K filings.
    """
    company_name: str = Field(description="Company name or ticker")
    years_analyzed: List[str] = Field(description="Years included in analysis")
    business_evolution: BusinessEvolution
    success_factors: List[SuccessFactor] = Field(
        description="Key factors that made the company successful"
    )
    financial_performance: FinancialPerformance
    competitive_advantages: List[CompetitiveAdvantage]
    management_excellence: ManagementExcellence
    innovation_strategy: InnovationStrategy
    risk_management: RiskManagement
    value_creation: ValueCreation
    unique_attributes: List[str] = Field(
        description="Top 5-7 attributes that made this company unique"
    )
    future_outlook: FutureOutlook


# Export all models
__all__ = [
    'TenKAnalysis',
    'FinancialHighlights',
    'CustomDeepDiveAnalysis',
    'FocusedAnalysis',
    'EVManufacturerMetrics',
    'RevenueSegment',
    'GeographicBreakdown',
    'BusinessModelSustainability',
    'CompetitivePositioning',
    'FinancialHealth',
    'RiskAssessment',
    # Multi-year schemas
    'CompanySuccessFactors',
    'BusinessEvolution',
    'SuccessFactor',
    'FinancialPerformance',
    'CompetitiveAdvantage',
    'ManagementExcellence',
    'InnovationStrategy',
    'RiskManagement',
    'ValueCreation',
    'FutureOutlook',
    'StrategicChange',
]
